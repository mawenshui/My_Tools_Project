# SSH客户端项目规范文档

## 1. 项目概述

### 1.1 项目简介
SSH客户端是一个基于Qt框架开发的跨平台SSH连接工具，支持Windows和Linux平台。项目采用C++语言开发，提供图形化界面，支持SSH密钥认证、命令执行、密钥生成等功能。

### 1.2 技术栈
- **开发语言**: C++11
- **GUI框架**: Qt 5.x+
- **构建系统**: qmake
- **编译器**: MinGW (Windows) / GCC (Linux)
- **网络库**: Qt Network
- **进程管理**: QProcess

### 1.3 项目目标
- 提供简单易用的SSH连接工具
- 支持跨平台部署和使用
- 实现安全的SSH密钥管理
- 提供良好的用户体验和错误处理

## 2. 项目架构

### 2.1 整体架构
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   UI Layer      │    │  Business Layer │    │  System Layer   │
│                 │    │                 │    │                 │
│ SSHClientWidget │◄──►│   SSHClient     │◄──►│   QProcess      │
│ KeyGenDialog    │    │                 │    │   QTcpSocket    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 2.2 核心模块

#### 2.2.1 UI层 (Presentation Layer)
- **SSHClientWidget**: 主窗口界面，负责用户交互
- **KeyGenDialog**: 密钥生成对话框
- **UI文件**: .ui文件定义界面布局

#### 2.2.2 业务层 (Business Layer)
- **SSHClient**: SSH连接核心逻辑
- **密钥管理**: SSH密钥生成和验证
- **命令执行**: 远程命令执行和结果处理

#### 2.2.3 系统层 (System Layer)
- **QProcess**: 进程管理和命令执行
- **QTcpSocket**: 网络连接检测
- **文件系统**: 密钥文件读写操作

### 2.3 数据流
```
用户输入 → UI验证 → 业务逻辑处理 → 系统调用 → 结果返回 → UI显示
```

## 3. 代码规范

### 3.1 命名规范

#### 3.1.1 类名
- 使用帕斯卡命名法 (PascalCase)
- 示例: `SSHClient`, `KeyGenDialog`, `SSHClientWidget`

#### 3.1.2 函数名
- 使用驼峰命名法 (camelCase)
- 槽函数使用 `on_` 前缀
- 示例: `connectToHost()`, `on_connectButton_clicked()`

#### 3.1.3 变量名
- 成员变量使用 `m_` 前缀
- 局部变量使用驼峰命名法
- 常量使用全大写加下划线
- 示例: `m_sshClient`, `hostAddress`, `MAX_RETRY_COUNT`

#### 3.1.4 文件名
- 头文件使用 `.h` 扩展名
- 源文件使用 `.cpp` 扩展名
- 文件名与类名保持一致，使用小写
- 示例: `sshclient.h`, `sshclient.cpp`

### 3.2 代码格式

#### 3.2.1 缩进和空格
- 使用4个空格进行缩进，不使用Tab
- 运算符前后添加空格
- 逗号后添加空格

#### 3.2.2 大括号
- 使用Allman风格，大括号独占一行
```cpp
if (condition)
{
    // 代码块
}
```

#### 3.2.3 行长度
- 每行代码不超过120个字符
- 超长行使用适当的换行和缩进

### 3.3 注释规范

#### 3.3.1 文件头注释
```cpp
/**
 * @file sshclient.h
 * @brief SSH客户端核心类定义
 * @author 开发者姓名
 * @date 创建日期
 */
```

#### 3.3.2 类注释
```cpp
/**
 * @class SSHClient
 * @brief SSH连接和命令执行的核心类
 * 
 * 该类负责管理SSH连接、执行远程命令、处理认证等功能。
 * 支持密钥文件认证方式，提供异步的连接和命令执行接口。
 */
```

#### 3.3.3 函数注释
```cpp
/**
 * @brief 连接到远程SSH服务器
 * @param host 远程主机地址
 * @param port SSH端口号
 * @param username 用户名
 * @param keyFilePath 私钥文件路径
 * @param keyFilePassword 私钥密码（可选）
 */
void connectToHost(const QString &host, int port, const QString &username, 
                   const QString &keyFilePath, const QString &keyFilePassword = QString());
```

### 3.4 错误处理规范

#### 3.4.1 异常处理
- 使用Qt的信号槽机制处理异步错误
- 避免使用C++异常，优先使用返回值和信号

#### 3.4.2 错误信息
- 错误信息应该具体、有用
- 提供解决方案建议
- 支持中文错误提示

#### 3.4.3 日志记录
- 使用Qt的日志系统 (qDebug, qInfo, qWarning, qCritical)
- 重要操作必须记录日志
- 敏感信息（如密码）不得记录到日志

## 4. 开发流程

### 4.1 开发环境搭建

#### 4.1.1 必需软件
- Qt 5.12+ (推荐Qt 5.15)
- Qt Creator IDE
- MinGW 7.3+ (Windows) / GCC 7+ (Linux)
- Git版本控制

#### 4.1.2 项目配置
1. 克隆项目代码
2. 使用Qt Creator打开 `SSHClient.pro`
3. 配置编译器和构建套件
4. 编译并运行项目

### 4.2 开发规范

#### 4.2.1 分支管理
- `main`: 主分支，保持稳定
- `develop`: 开发分支，集成新功能
- `feature/*`: 功能分支，开发具体功能
- `bugfix/*`: 修复分支，修复特定问题

#### 4.2.2 提交规范
- 提交信息使用中文
- 格式: `[类型] 简短描述`
- 类型: 新增、修复、优化、重构、文档
- 示例: `[新增] SSH密钥生成功能`

#### 4.2.3 代码审查
- 所有代码变更必须经过代码审查
- 审查重点: 功能正确性、代码质量、性能影响
- 使用Pull Request进行代码审查

### 4.3 测试规范

#### 4.3.1 单元测试
- 核心业务逻辑必须有单元测试
- 使用Qt Test框架编写测试
- 测试覆盖率要求达到80%以上

#### 4.3.2 集成测试
- 测试各模块间的交互
- 测试完整的用户使用流程
- 跨平台兼容性测试

#### 4.3.3 用户测试
- 界面易用性测试
- 错误处理测试
- 性能压力测试

## 5. 部署规范

### 5.1 构建配置

#### 5.1.1 Release构建
- 使用Release模式编译
- 启用编译器优化
- 移除调试信息和符号

#### 5.1.2 依赖管理
- 静态链接Qt库（推荐）
- 或提供Qt运行时库
- 包含必要的系统依赖

### 5.2 打包发布

#### 5.2.1 Windows平台
- 使用windeployqt工具打包
- 创建安装程序（NSIS或Inno Setup）
- 数字签名（如有证书）

#### 5.2.2 Linux平台
- 创建AppImage或deb/rpm包
- 处理库依赖关系
- 提供桌面文件和图标

### 5.3 版本管理

#### 5.3.1 版本号规范
- 使用语义化版本号: `主版本.次版本.修订版本`
- 主版本: 不兼容的API修改
- 次版本: 向下兼容的功能性新增
- 修订版本: 向下兼容的问题修正

#### 5.3.2 发布说明
- 每个版本提供详细的更新日志
- 说明新功能、改进和修复
- 提供升级指导和注意事项

## 6. 安全规范

### 6.1 密钥安全

#### 6.1.1 密钥生成
- 使用强随机数生成器
- 支持多种密钥类型（RSA、ED25519）
- 推荐使用4096位RSA或ED25519

#### 6.1.2 密钥存储
- 私钥文件设置正确权限（600）
- 支持密钥密码保护
- 不在内存中长期保存密码

#### 6.1.3 密钥传输
- 使用安全的密钥部署方式
- 避免明文传输私钥
- 验证远程主机身份

### 6.2 代码安全

#### 6.2.1 输入验证
- 验证所有用户输入
- 防止命令注入攻击
- 限制输入长度和格式

#### 6.2.2 内存安全
- 及时清理敏感数据
- 避免内存泄漏
- 使用安全的字符串处理函数

#### 6.2.3 进程安全
- 限制子进程权限
- 设置进程超时
- 安全地终止进程

## 7. 性能规范

### 7.1 响应时间
- UI响应时间 < 100ms
- SSH连接建立 < 5s
- 命令执行响应 < 1s

### 7.2 资源使用
- 内存使用 < 50MB
- CPU使用率 < 10%（空闲时）
- 磁盘空间 < 100MB

### 7.3 并发处理
- 支持多个SSH连接
- 异步处理网络操作
- 避免阻塞UI线程

## 8. 维护规范

### 8.1 代码维护
- 定期重构和优化代码
- 更新依赖库版本
- 修复已知问题和漏洞

### 8.2 文档维护
- 保持文档与代码同步
- 更新用户手册和API文档
- 维护项目Wiki和FAQ

### 8.3 社区支持
- 及时回复用户反馈
- 处理GitHub Issues
- 发布定期更新

## 9. 质量保证

### 9.1 代码质量
- 使用静态代码分析工具
- 定期进行代码审查
- 遵循编码规范和最佳实践

### 9.2 功能质量
- 完整的功能测试
- 边界条件测试
- 错误场景测试

### 9.3 用户体验
- 界面一致性检查
- 易用性测试
- 无障碍访问支持

## 10. 附录

### 10.1 相关文档
- [Qt官方文档](https://doc.qt.io/)
- [SSH协议规范](https://tools.ietf.org/html/rfc4251)
- [OpenSSH文档](https://www.openssh.com/manual.html)

### 10.2 工具推荐
- **IDE**: Qt Creator, Visual Studio Code
- **调试**: GDB, Qt Creator调试器
- **性能分析**: Valgrind, Qt Creator性能分析器
- **静态分析**: Clang Static Analyzer, PVS-Studio

### 10.3 联系方式
- 项目仓库: [GitHub链接]
- 问题反馈: [Issues链接]
- 技术讨论: [讨论区链接]

---

**文档版本**: 1.0  
**最后更新**: 2024年  
**维护者**: 项目开发团队